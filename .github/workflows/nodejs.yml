name: node

on:
  push:
    branches: # autodeploy
      - main
  workflow_dispatch: # manual trigger

jobs:
  node-check:
    name: node check
    runs-on: ubuntu-latest
    environment: ${{ github.ref_name == 'prod' && 'prod' || github.ref_name == 'staging' && 'staging' || 'dev' }}
    strategy:
      matrix:
        node-version: [16.15.0]
    env:
      NODE_OPTIONS: "--max_old_space_size=4096"
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
      - name: total memory size
        run: node -e 'require('os').totalmem() / (1024*1024)'
      - name: heap size
        run: node -e 'console.log(v8.getHeapStatistics().heap_size_limit/(1024*1024))'
      - name: node options
        run: node -e 'console.log(process.execArgv)'
      - name: echo node options
        run: echo $NODE_OPTIONS
